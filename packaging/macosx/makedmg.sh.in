#!/bin/sh
#
# Copyright 2004-2009 Kongsberg SIM, All rights reserved.
#
# This script (almost) automatically creates a dmg file for distribution
# from a directory of source files.
# 
# Usage: makedmg.sh -v <volumename> -o <outname> -r <rootdir>
#  -v   Volume name (e.g. -v Coin-2.1.0)
#  -o   Output file name (e.g. -o Coin-2.1.0-no_inst.dmg)
#  -r   Directory with contents of the DMG (e.g. path/to/noinst-dmg-root)
#
#
# FIXME: Automatically set background image of folder (kintel 20040116)
#
# Authors:
#   Marius Kintel <kintel@sim.no>
#   Tom Fredrik Klaussen <bfg@sim.no>

printUsage()
{
  echo "Usage: $0 -v <volumename> -o <outfile> -r <rootdir>"
  echo
  echo "  Example: $0 -v Coin-2.1.0 -o Coin-2.1.0-no_inst.dmg -r path/to/dmg-root"
}

while getopts 'v:o:r:' c
do
  case $c in
    v) VOLNAME=$OPTARG;;
    o) OUTNAME=$OPTARG;;
    r) ROOT=$OPTARG;;
  esac
done

if test -z "$VOLNAME" -o -z "$OUTNAME" -o -z "$ROOT"; then
  printUsage
  exit 1
fi

# Hide files
/Developer/Tools/SetFile -a V /tmp/$VOLNAME/.VolumeIcon.icns
/Developer/Tools/SetFile -a V /tmp/$VOLNAME/.DS_Store
/Developer/Tools/SetFile -a V /tmp/$VOLNAME/Desktop\ DB
/Developer/Tools/SetFile -a V /tmp/$VOLNAME/Desktop\ DF
/Developer/Tools/SetFile -a V /tmp/$VOLNAME/dmg_bg.tiff
# We have a custom volume icon
/Developer/Tools/SetFile -a C /tmp/$VOLNAME

left=50
top=90
xspacing=170
yspacing=150
let x1=left+xspacing
let y1=top+yspacing

@top_srcdir@/packaging/macosx/create-dmg --volname ${VOLNAME} --background @top_srcdir@/packaging/macosx/noinst-dmg-files/dmg_bg.tiff --window-size 340 370 --icon README.txt ${x1} ${top}  --icon Coin.pkg ${left} ${top} --icon CoinTools.pkg ${left} ${y1} --icon Inventor.framework ${x1} ${y1} $OUTNAME /tmp/$VOLNAME
